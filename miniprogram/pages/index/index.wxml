<view class="container {{showLoginForm ? 'confirm-mode' : ''}}">
  <!-- 背景装饰 -->
  <view class="bg-circle-1"></view>
  <view class="bg-circle-2"></view>

  <!-- 顶部品牌区 -->
  <view class="hero {{showLoginForm ? 'hero-confirm' : ''}}">
    <text class="app-name">StudyTracker</text>
    <text class="sub-name">by Sage path edu.</text>
    <text class="slogan">让每一次进步都看得见</text>
  </view>

  <!-- 主卡片区域 -->
  <view class="main-card">

    <!-- 0. 欢迎引导页 -->
    <view class="welcome-intro" wx:if="{{!hasToken && !showLoginForm}}">
      <view class="intro-content">
        <text class="intro-title">📚 智能学习管理</text>
        <view class="feature-list">
          <view class="feature-item">
            <text class="feature-emoji">✅</text>
            <view class="feature-texts">
              <text class="feature-title">任务打卡</text>
              <text class="feature-desc">每日学习进度一目了然</text>
            </view>
          </view>
          <view class="feature-item">
            <text class="feature-emoji">📊</text>
            <view class="feature-texts">
              <text class="feature-title">数据统计</text>
              <text class="feature-desc">可视化学习成果</text>
            </view>
          </view>
          <view class="feature-item">
            <text class="feature-emoji">🎯</text>
            <view class="feature-texts">
              <text class="feature-title">智能材料</text>
              <text class="feature-desc">口语朗读、写作训练</text>
            </view>
          </view>
          <view class="feature-item">
            <text class="feature-emoji">👨‍👩‍👧</text>
            <view class="feature-texts">
              <text class="feature-title">家长监督</text>
              <text class="feature-desc">随时了解学习情况</text>
            </view>
          </view>
        </view>

        <view class="privacy-section">
          <checkbox-group bindchange="handleLandingPrivacyChange">
            <label class="privacy-label">
              <checkbox value="agree" checked="{{landingAgreed}}" color="#07c160" style="transform:scale(0.7)"/>
              <text class="privacy-text">我已阅读并同意 <text class="link" catchtap="openPrivacyContract">《用户协议》</text> 和 <text class="link" catchtap="openPrivacyContract">《隐私政策》</text></text>
            </label>
          </checkbox-group>
        </view>

        <button class="btn-start {{!landingAgreed ? 'btn-disabled' : ''}}" bindtap="startUse">开始使用</button>
        <button class="btn-ghost" bindtap="showPreview">先随便看看</button>
      </view>
    </view>

    <!-- 1. 登录引导 -->
    <view class="login-section" wx:if="{{!hasToken && showLoginForm}}">
    <view class="welcome-text">
      <text class="status-text">继续进入</text>
    </view>
      
      <!-- 隐私协议勾选 -->
      <view class="privacy-section">
        <checkbox-group bindchange="handlePrivacyChange">
          <label class="privacy-label">
            <checkbox value="agree" checked="{{privacyAgreed}}" color="#07c160" style="transform:scale(0.7)"/>
            <text class="privacy-text">我已阅读并同意 <text class="link" catchtap="openPrivacyContract">《用户协议》</text> 和 <text class="link" catchtap="openPrivacyContract">《隐私政策》</text></text>
          </label>
        </checkbox-group>
      </view>

      <button class="btn-primary {{!privacyAgreed ? 'btn-disabled' : ''}}" bindtap="handleLogin">
        微信一键登录
      </button>
      <button class="btn-back" bindtap="backToWelcome">取消登录</button>
    </view>

    <!-- 2. 角色选择 -->
    <view class="role-section" wx:if="{{hasToken && isGuest}}">
      <text class="section-title">请选择您的身份</text>
      <view class="role-grid">
        <view class="role-item student" bindtap="selectRole" data-role="student">
          <view class="role-icon-bg">🎓</view>
          <text class="role-label">我是学生</text>
          <text class="role-desc">查看任务 · 提交打卡</text>
        </view>
        <view class="role-item parent" bindtap="selectRole" data-role="parent">
          <view class="role-icon-bg">👨‍👩‍👧</view>
          <text class="role-label">我是家长</text>
          <text class="role-desc">关注成长 · 查看报告</text>
        </view>
        <view class="role-item teacher" bindtap="selectRole" data-role="teacher">
          <view class="role-icon-bg">👨‍🏫</view>
          <text class="role-label">我是老师</text>
          <text class="role-desc">查看课表 · 订阅提醒</text>
        </view>
      </view>
    </view>

    <!-- 2.5 绑定已有账号 -->
    <view class="bind-existing-section" wx:if="{{showExistingBindForm}}">
      <text class="section-title">绑定已有账号</text>
      <text class="section-subtitle">请输入后台创建的老师账号与密码</text>

      <view class="input-group">
        <text class="input-label">用户名</text>
        <input class="input-field" placeholder="后台用户名" model:value="{{existingUsername}}" />
      </view>

      <view class="input-group">
        <text class="input-label">密码</text>
        <input class="input-field" password="true" placeholder="后台密码" model:value="{{existingPassword}}" />
      </view>

      <view class="action-buttons">
        <button class="btn-cancel" bindtap="cancelExistingBind">取消</button>
        <button class="btn-confirm" bindtap="confirmExistingBind" loading="{{existingLoading}}" disabled="{{existingLoading}}">绑定账号</button>
      </view>
    </view>

    <!-- 3. 绑定表单 -->
    <view class="bind-section" wx:if="{{showBindForm}}">
      <text class="section-title">完善信息</text>
      <text class="section-subtitle">绑定{{targetRole === 'student' ? '学生' : '家长'}}身份以开始使用</text>
      
      <view class="input-group">
        <text class="input-label">姓名</text>
        <input class="input-field" placeholder="请输入真实姓名" model:value="{{bindName}}" />
      </view>
      
      <view class="input-group" wx:if="{{targetRole === 'parent'}}">
        <text class="input-label">孩子姓名</text>
        <input class="input-field" placeholder="请输入孩子的姓名" model:value="{{bindStudentName}}" />
      </view>

      <view class="input-group" wx:if="{{targetRole === 'parent'}}">
        <text class="input-label">手机号</text>
        <input class="input-field" type="number" placeholder="请输入手机号码" model:value="{{bindPhone}}" />
      </view>

      <view class="action-buttons">
        <button class="btn-cancel" bindtap="cancelBind">取消</button>
        <button class="btn-confirm" bindtap="confirmBind">确认绑定</button>
      </view>
    </view>

  </view>
</view>
