<view class="container">
  <!-- 背景装饰 -->
  <view class="bg-circle-1"></view>
  <view class="bg-circle-2"></view>

  <!-- 品牌区域 -->
  <view class="brand-area">
    <!-- <image class="brand-logo" src="/images/logo.jpg" mode="widthFix"></image> -->
    <text class="app-name">StudyTracker</text>
    <text class="sub-name">by Sage path edu.</text>
    <text class="slogan">让每一次进步都看得见</text>
  </view>

  <!-- 主卡片区域 -->
  <view class="main-card">
    
    <!-- 0. 欢迎引导页（新增） -->
    <view class="welcome-intro" wx:if="{{!hasToken && !showLoginForm}}">
      <view class="intro-content">
        <text class="intro-title">📚 智能学习管理</text>
        <view class="feature-list">
          <view class="feature-item">
            <text class="feature-icon">✅</text>
            <text class="feature-text">任务打卡 - 每日学习进度一目了然</text>
          </view>
          <view class="feature-item">
            <text class="feature-icon">📊</text>
            <text class="feature-text">数据统计 - 可视化学习成果</text>
          </view>
          <view class="feature-item">
            <text class="feature-icon">🎯</text>
            <text class="feature-text">智能材料 - 口语朗读、写作训练</text>
          </view>
          <view class="feature-item">
            <text class="feature-icon">👨‍👩‍👧</text>
            <text class="feature-text">家长监督 - 随时了解孩子学习情况</text>
          </view>
        </view>
        <button class="btn-start" bindtap="showLogin">开始使用</button>
        <button class="btn-ghost" bindtap="showPreview">先随便看看</button>
        <text class="tip-text">点击上方按钮即表示同意用户协议和隐私政策</text>
      </view>
    </view>

    <!-- 预览区：无需登录 -->
    <view class="preview-section" wx:if="{{showPreview}}">
      <text class="section-title">功能预览</text>
      <view class="preview-grid">
        <view class="preview-card">
          <text class="preview-title">任务列表</text>
          <text class="preview-desc">查看每日任务与完成度示例，不登录也可浏览界面。</text>
        </view>
        <view class="preview-card">
          <text class="preview-title">数据概览</text>
          <text class="preview-desc">进度统计、正确率示意，让你先了解功能布局。</text>
        </view>
        <view class="preview-card">
          <text class="preview-title">批改反馈</text>
          <text class="preview-desc">查看批改反馈样例，体验交互流程。</text>
        </view>
      </view>
      <button class="btn-primary" bindtap="showLogin">去登录体验完整功能</button>
      <button class="btn-back" bindtap="backToWelcome">返回</button>
    </view>
    
    <!-- 1. 登录引导 -->
    <view class="login-section" wx:if="{{!hasToken && showLoginForm}}">
      <view class="welcome-text">
        <text class="h1">欢迎回来</text>
        <text class="p">请登录以继续您的学习之旅</text>
      </view>
      
      <!-- 隐私协议勾选 -->
      <view class="privacy-section">
        <checkbox-group bindchange="handlePrivacyChange">
          <label class="privacy-label">
            <checkbox value="agree" checked="{{privacyAgreed}}" color="#07c160" style="transform:scale(0.7)"/>
            <text class="privacy-text">我已阅读并同意 <text class="link" catchtap="openPrivacyContract">《用户协议》</text> 和 <text class="link" catchtap="openPrivacyContract">《隐私政策》</text></text>
          </label>
        </checkbox-group>
      </view>

      <button class="btn-primary {{!privacyAgreed ? 'btn-disabled' : ''}}" bindtap="handleLogin">
        <text class="wechat-icon">💬</text> 微信一键登录
      </button>
      <button class="btn-back" bindtap="backToWelcome">返回</button>
    </view>

    <!-- 2. 角色选择 -->
    <view class="role-section" wx:if="{{hasToken && isGuest}}">
      <text class="section-title">请选择您的身份</text>
      <view class="role-grid">
        <view class="role-item student" bindtap="selectRole" data-role="student">
          <view class="role-icon-bg">🎓</view>
          <text class="role-label">我是学生</text>
          <text class="role-desc">查看任务 · 提交打卡</text>
        </view>
        <view class="role-item parent" bindtap="selectRole" data-role="parent">
          <view class="role-icon-bg">👨‍👩‍👧</view>
          <text class="role-label">我是家长</text>
          <text class="role-desc">关注成长 · 查看报告</text>
        </view>
      </view>
    </view>

    <!-- 3. 绑定表单 -->
    <view class="bind-section" wx:if="{{showBindForm}}">
      <text class="section-title">完善信息</text>
      <text class="section-subtitle">绑定{{targetRole === 'student' ? '学生' : '家长'}}身份以开始使用</text>
      
      <view class="input-group">
        <text class="input-label">姓名</text>
        <input class="input-field" placeholder="请输入真实姓名" model:value="{{bindName}}" />
      </view>
      
      <view class="input-group" wx:if="{{targetRole === 'parent'}}">
        <text class="input-label">孩子姓名</text>
        <input class="input-field" placeholder="请输入孩子的姓名" model:value="{{bindStudentName}}" />
      </view>

      <view class="input-group" wx:if="{{targetRole === 'parent'}}">
        <text class="input-label">手机号</text>
        <input class="input-field" type="number" placeholder="请输入手机号码" model:value="{{bindPhone}}" />
      </view>

      <view class="action-buttons">
        <button class="btn-cancel" bindtap="cancelBind">取消</button>
        <button class="btn-confirm" bindtap="confirmBind">确认绑定</button>
      </view>
    </view>

  </view>
</view>
