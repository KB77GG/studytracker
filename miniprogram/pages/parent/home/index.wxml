<view class="container">
  <!-- é¡¶éƒ¨èƒŒæ™¯ -->
  <view class="bg-gradient"></view>

  <block wx:if="{{students.length > 0}}">
    <!-- é¡¶éƒ¨æ  -->
    <view class="header">
      <view class="header-left">
        <text class="date">{{todayDate}}</text>
        <text class="greeting">å®¶é•¿ï¼Œæ‚¨å¥½</text>
      </view>
      <picker bindchange="switchStudent" value="{{currentStudentIndex}}" range="{{students}}" range-key="name">
        <view class="student-picker">
          <image class="picker-icon" src="/images/icons/student.png" wx:if="{{false}}"></image>
          <text class="current-student">{{students[currentStudentIndex].name}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <!-- æ¦‚è§ˆå¡ç‰‡ -->
    <view class="stats-card glass-card">
      <view class="stats-header">
        <view class="stats-title-group">
          <text class="stats-title">ä»Šæ—¥æ¦‚è§ˆ</text>
          <text class="stats-subtitle">å®æ—¶æ›´æ–°</text>
        </view>
        <view class="stats-rate">
          <text class="rate-num">{{stats.today.rate}}</text>
          <text class="rate-unit">%</text>
          <text class="rate-label">å®Œæˆç‡</text>
        </view>
      </view>
      <view class="stats-grid">
        <view class="grid-item">
          <text class="num">{{stats.today.pending}}</text>
          <text class="label">å¾…å®¡æ ¸</text>
        </view>
        <view class="grid-item">
          <text class="num">{{stats.today.completed}}</text>
          <text class="label">å·²å®Œæˆ</text>
        </view>
        <view class="grid-item">
          <text class="num">{{stats.today.in_progress}}</text>
          <text class="label">è¿›è¡Œä¸­</text>
        </view>
        <view class="grid-item">
          <text class="num">{{stats.today.total}}</text>
          <text class="label">æ€»ä»»åŠ¡</text>
        </view>
      </view>
    </view>

    <!-- æ•°æ®å›¾è¡¨åŒºåŸŸ -->
    <view class="charts-row">
      <!-- æœ¬å‘¨è¶‹åŠ¿ (æŸ±çŠ¶å›¾) -->
      <view class="chart-card glass-card">
        <view class="section-header">
          <text class="section-title">æœ¬å‘¨è¶‹åŠ¿</text>
        </view>
        <view class="bar-chart">
          <view class="bar-item" wx:for="{{stats.weekly}}" wx:key="date">
            <view class="bar-column">
              <view class="bar-fill" style="height: {{item.rate}}%; background: {{item.rate >= 80 ? '#4CAF50' : (item.rate >= 50 ? '#FFC107' : '#FF5252')}}"></view>
            </view>
            <text class="bar-label">{{item.date}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å­¦ç§‘åˆ†å¸ƒ (è¿›åº¦æ¡) -->
    <view class="chart-card glass-card" wx:if="{{stats.subjects && stats.subjects.length > 0}}">
      <view class="section-header">
        <text class="section-title">å­¦ç§‘åˆ†å¸ƒ (è¿‘30å¤©)</text>
      </view>
      <view class="subject-list">
        <view class="subject-item" wx:for="{{stats.subjects}}" wx:key="subject">
          <view class="subject-info">
            <text class="subject-name">{{item.subject}}</text>
            <text class="subject-count">{{item.count}}æ¬¡</text>
          </view>
          <view class="progress-track">
            <view class="progress-bar" style="width: {{item.percent}}%"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- æœ€è¿‘åŠ¨æ€ -->
    <view class="section-header mt-40">
      <text class="section-title-large">æœ€è¿‘åŠ¨æ€</text>
    </view>
    <view class="feed-list">
      <block wx:if="{{stats.recent.length > 0}}">
        <view class="feed-item" wx:for="{{stats.recent}}" wx:key="id">
          <view class="feed-left">
            <view class="feed-line"></view>
            <view class="feed-dot {{item.status === 'done' ? 'dot-green' : 'dot-blue'}}"></view>
          </view>
          <view class="feed-right">
            <view class="feed-header">
              <text class="feed-cat">{{item.category}}</text>
              <text class="feed-date">{{item.date}}</text>
            </view>
            <view class="feed-content">
              <text class="feed-detail">{{item.detail}}</text>
            </view>
            <view class="feed-footer">
              <view class="feed-score" wx:if="{{item.accuracy !== null}}">
                æ­£ç¡®ç‡ <text class="highlight">{{item.accuracy}}%</text>
              </view>
              <view class="feed-score" wx:elif="{{item.completion_rate !== null}}">
                å®Œæˆç‡ <text class="highlight">{{item.completion_rate}}%</text>
              </view>
              <view class="feed-teacher-note" wx:if="{{item.teacher_note}}">
                <text class="note-icon">ğŸ‘©â€ğŸ«</text> {{item.teacher_note}}
              </view>
            </view>
          </view>
        </view>
      </block>
      <view wx:else class="empty-feed">
        æš‚æ— æœ€è¿‘åŠ¨æ€
      </view>
    </view>
  </block>

  <block wx:else>
    <view class="empty-state">
      <image class="empty-img" src="/images/empty.png" mode="widthFix" wx:if="{{false}}"></image>
      <text>æœªç»‘å®šä»»ä½•å­¦ç”Ÿï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚</text>
    </view>
  </block>
</view>
