<view class="container">
  <!-- é¡¶éƒ¨æ¬¢è¿åŒº -->
  <view class="header-section">
    <view class="greeting">
      <text class="hello">{{greeting}}ï¼Œ{{userInfo.nickName}}</text>
      <text class="sub-text">å‡†å¤‡å¥½å¼€å§‹ä»Šå¤©çš„å­¦ä¹ äº†å—ï¼Ÿ</text>
    </view>
    <picker mode="date" value="{{currentDate}}" bindchange="handleDateChange">
      <view class="date-badge">
        {{dateStr}} <text class="picker-arrow">â–¼</text>
      </view>
    </picker>
  </view>

  <!-- è¿›åº¦å¡ç‰‡ -->
  <view class="progress-card">
    <view class="progress-info">
      <text class="progress-label">ä»Šæ—¥å®Œæˆåº¦</text>
      <text class="progress-value">{{progress.completed}}/{{progress.total}}</text>
    </view>
    <view class="progress-bar-bg">
      <view class="progress-bar-fill" style="width: {{progress.percent}}%"></view>
    </view>
    <text class="progress-tips" wx:if="{{progress.percent === 100}}">å¤ªæ£’äº†ï¼ä»Šæ—¥ä»»åŠ¡å…¨éƒ¨å®Œæˆ ğŸ‰</text>
    <text class="progress-tips" wx:elif="{{progress.percent > 0}}">ç»§ç»­åŠ æ²¹ï¼Œä¿æŒèŠ‚å¥ï¼ğŸ’ª</text>
    <text class="progress-tips" wx:else>åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ ğŸš€</text>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view class="section-title">æˆ‘çš„ä»»åŠ¡</view>
  
  <view class="task-list" wx:if="{{tasks.length > 0}}">
    <view class="task-card {{item.isDone ? 'done' : ''}}" wx:for="{{tasks}}" wx:key="id">
      <view class="card-main" bindtap="goToTaskDetail" data-id="{{item.id}}">
        <view class="card-left">
          <view class="task-icon {{item.moduleClass}}">{{item.module[0]}}</view>
          <view class="task-content">
            <text class="task-name">{{item.task_name}}</text>
            <text class="task-time">é¢„è®¡ {{item.planned_minutes}}åˆ†é’Ÿ</text>
          </view>
        </view>
        <view class="card-right">
          <view class="status-badge {{item.status}}">{{item.statusText}}</view>
        </view>
      </view>
      
      <!-- Timer Section -->
      <view class="timer-section" wx:if="{{!item.isDone}}">
        <view class="timer-display {{item.timerStatus}}">
          <text class="timer-label">â±ï¸</text>
          <text class="timer-text {{item.isOvertime ? 'overtime' : ''}}">
            {{item.displayTime}} / {{item.plannedTime}}
          </text>
        </view>
        <view class="timer-controls">
          <button wx:if="{{item.timerStatus === 'idle'}}" class="timer-btn start" catchtap="startTimer" data-id="{{item.id}}">å¼€å§‹</button>
          <button wx:if="{{item.timerStatus === 'running'}}" class="timer-btn pause" catchtap="pauseTimer" data-id="{{item.id}}">æš‚åœ</button>
          <button wx:if="{{item.timerStatus === 'paused'}}" class="timer-btn resume" catchtap="resumeTimer" data-id="{{item.id}}">ç»§ç»­</button>
          <button wx:if="{{item.timerStatus === 'running' || item.timerStatus === 'paused'}}" class="timer-btn stop" catchtap="stopTimer" data-id="{{item.id}}">ç»“æŸ</button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <image class="empty-img" src="/images/empty-box.png" mode="aspectFit" wx:if="{{false}}"></image> <!-- æš‚æ—¶éšè—å›¾ç‰‡ -->
    <text class="empty-text">ä»Šå¤©æ²¡æœ‰ä»»åŠ¡å“¦</text>
    <text class="empty-sub">å¥½å¥½ä¼‘æ¯ï¼Œæ˜å¤©ç»§ç»­åŠ æ²¹ï¼</text>
  </view>
</view>
