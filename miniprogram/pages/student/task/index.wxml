<view class="container">
  <view class="task-header">
    <text class="task-title">{{task.task_name}}</text>
    <text class="task-module">{{task.module}}</text>
  </view>

  <view class="task-info-card">
    <view class="info-row">
      <text class="label">è®¡åˆ’æ—¶é•¿</text>
      <text class="value">{{task.planned_minutes}} åˆ†é’Ÿ</text>
    </view>
    <view class="info-row">
      <text class="label">ä»»åŠ¡è¯´æ˜</text>
      <text class="value">{{task.instructions || 'æš‚æ— è¯´æ˜'}}</text>
    </view>
    <view class="info-row">
      <text class="label">çŠ¶æ€</text>
      <text class="value status-{{task.student_status}}">{{statusText}}</text>
    </view>
  </view>

  <!-- å½•éŸ³åŒºåŸŸ (ä»…å£è¯­ä»»åŠ¡æ˜¾ç¤º) -->
  <view class="upload-section" wx:if="{{showAudio}}">
    <text class="section-title">ğŸ“¢ å£è¯­å½•éŸ³</text>
    <view class="audio-recorder">
      <button class="record-btn {{recording ? 'recording' : ''}}" 
              bindtouchstart="startRecord" 
              bindtouchend="stopRecord">
        {{recording ? 'æ¾å¼€ç»“æŸ' : 'æŒ‰ä½å½•éŸ³'}}
      </button>
      <text class="duration" wx:if="{{recordDuration > 0}}">{{recordDuration}}ç§’</text>
    </view>
    
    <view class="audio-list" wx:if="{{audioFiles.length > 0}}">
      <view class="audio-item" wx:for="{{audioFiles}}" wx:key="index">
        <text class="audio-name">å½•éŸ³ {{index + 1}}</text>
        <button class="btn-play" size="mini" bindtap="playAudio" data-url="{{item}}">æ’­æ”¾</button>
        <button class="btn-delete" size="mini" bindtap="deleteAudio" data-index="{{index}}">åˆ é™¤</button>
      </view>
    </view>
  </view>

  <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
  <view class="upload-section">
    <text class="section-title">ğŸ“· ä½œä¸šç…§ç‰‡</text>
    <view class="image-grid">
      <view class="image-item" wx:for="{{images}}" wx:key="index">
        <image src="{{item}}" mode="aspectFill" bindtap="previewImage" data-url="{{item}}"></image>
        <icon type="clear" size="20" class="delete-icon" bindtap="deleteImage" data-index="{{index}}"></icon>
      </view>
      <view class="image-item add-btn" bindtap="chooseImage" wx:if="{{images.length < 9}}">
        <text>+</text>
      </view>
    </view>
  </view>

  <!-- å¤‡æ³¨ -->
  <view class="upload-section">
    <text class="section-title">ğŸ’¬ å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</text>
    <textarea class="note-input" placeholder="å†™ä¸‹ä½ çš„å­¦ä¹ ç¬”è®°æˆ–é‡åˆ°çš„é—®é¢˜..." model:value="{{note}}" maxlength="300"></textarea>
  </view>

  <!-- æäº¤æŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn-submit" bindtap="submitTask" disabled="{{submitting}}">
      {{submitting ? 'æäº¤ä¸­...' : 'æäº¤ä»»åŠ¡'}}
    </button>
  </view>
</view>
