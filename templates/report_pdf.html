<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <title>å­¦ä¹ ä»»åŠ¡æ±‡æ€»æŠ¥å‘Š</title>
</head>

<body>
  <div class="header-section">
    <div class="logo-container">
      <img src="file:///root/apps/studytracker/static/logo.jpg" alt="Sage Path" class="logo">
    </div>
    <div class="title-group">
      <h1>å­¦ä¹ ä»»åŠ¡æ±‡æ€»æŠ¥å‘Š</h1>
      <div class="title-underline"></div>
    </div>
  </div>

  <div class="meta">
    <div class="meta-row">
      <span class="meta-label">ç”Ÿæˆæ—¶é—´ï¼š</span>{{ generated_at.strftime("%Y-%m-%d %H:%M") }}
    </div>
    <div class="meta-row">
      <span class="meta-label">æ—¶é—´èŒƒå›´ï¼š</span>{{ filters.start }} ï½ {{ filters.end }}
    </div>
    {% if single_student %}
    <div class="meta-row">
      <span class="meta-label">å­¦ç”Ÿï¼š</span>{{ single_student }}
    </div>
    {% elif filters.students %}
    <div class="meta-row">
      <span class="meta-label">å­¦ç”Ÿï¼š</span>{{ ', '.join(filters.students) }}
    </div>
    {% endif %}
    {% if filters.category %}
    <div class="meta-row">
      <span class="meta-label">ç±»åˆ«ï¼š</span>{{ filters.category }}
    </div>
    {% endif %}
  </div>

  <div class="section-divider"></div>

  <div class="cards">
    <div class="card">
      <div class="card-icon">ğŸ“Š</div>
      <div class="card-content">
        <div class="card-title">ä»»åŠ¡æ€»æ•°</div>
        <div class="card-value">{{ cards.total_tasks }}</div>
        <div class="card-subtitle">è¦†ç›–å­¦ç”Ÿï¼š{{ cards.total_students }}</div>
      </div>
    </div>
    <div class="card">
      <div class="card-icon">âœ…</div>
      <div class="card-content">
        <div class="card-title">å·²å®Œæˆ</div>
        <div class="card-value">{{ cards.completed_tasks }}</div>
        <div class="card-subtitle">
          å®Œæˆç‡ï¼š{{ '%.1f'|format(cards.avg_completion_rate) }}%
          <div class="progress-bar">
            <div class="progress-fill" style="width: {{ '%.1f'|format(cards.avg_completion_rate) }}%"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-icon">â±ï¸</div>
      <div class="card-content">
        <div class="card-title">å­¦ä¹ æ€»æ—¶é•¿</div>
        <div class="card-value">{{ '%.2f'|format(cards.total_hours) }} h</div>
        <div class="card-subtitle">æ—¥å‡ï¼š{{ '%.2f'|format(cards.avg_daily_hours) }} h</div>
      </div>
    </div>
    <div class="card">
      <div class="card-icon">ğŸ¯</div>
      <div class="card-content">
        <div class="card-title">å¹³å‡æ­£ç¡®ç‡</div>
        <div class="card-value">{{ '%.1f'|format(cards.avg_accuracy) }}%</div>
        {% if cards.top_category %}
        <div class="card-subtitle">æœ€è€—æ—¶ï¼š{{ cards.top_category.name }}ï¼ˆ{{ '%.2f'|format(cards.top_category.hours) }} hï¼‰
        </div>
        {% else %}
        <div class="card-subtitle">æœ€è€—æ—¶åˆ†ç±»ï¼šâ€”</div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="section-divider"></div>

  <div class="section">
    <h2 class="section-title">
      <span class="section-icon">ğŸ‘¥</span>
      å­¦ç”Ÿæ¦‚è§ˆ
    </h2>
    <table>
      <thead>
        <tr>
          <th>å­¦ç”Ÿ</th>
          <th>ä»»åŠ¡æ€»æ•°</th>
          <th>æœªå¼€å§‹</th>
          <th>è¿›è¡Œä¸­</th>
          <th>å·²å®Œæˆ</th>
          <th>å®Œæˆç‡</th>
          <th>å¹³å‡å®Œæˆç‡</th>
          <th>å¹³å‡æ­£ç¡®ç‡</th>
          <th>è®¡åˆ’ç”¨æ—¶<br>(æ€»/å‡)</th>
          <th>å®é™…ç”¨æ—¶<br>(æ€»/å‡)</th>
          <th>æ—¶é—´èŒƒå›´</th>
        </tr>
      </thead>
      <tbody>
        {% for row in summary %}
        <tr>
          <td class="student-name">{{ row.student }}</td>
          <td><strong>{{ row.total }}</strong></td>
          <td>{{ row.pending }}</td>
          <td>{{ row.progress }}</td>
          <td class="highlight-done">{{ row.done }}</td>
          <td>{{ '%.1f'|format(row.done_rate) }}%</td>
          <td>
            {% if row.avg_completion is not none %}
            {{ '%.1f'|format(row.avg_completion) }}%
            {% else %}
            â€”
            {% endif %}
          </td>
          <td class="highlight-accuracy">{{ '%.1f'|format(row.avg_accuracy) }}%</td>
          <td>{{ row.planned_minutes_sum }} / {{ '%.1f'|format(row.avg_planned) }}</td>
          <td>{{ '%.1f'|format(row.actual_minutes_sum) }} / {{ '%.1f'|format(row.avg_actual) }}</td>
          <td class="date-range">
            {% if row.first_date and row.last_date %}
            {{ row.first_date }}<br>ï½<br>{{ row.last_date }}
            {% else %}
            â€”
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="page-break"></div>

  <div class="section">
    <h2 class="section-title">
      <span class="section-icon">ğŸ“</span>
      ä»»åŠ¡æ˜ç»†
    </h2>
    <table>
      <thead>
        <tr>
          <th>å­¦ç”Ÿ</th>
          <th>æ—¥æœŸ</th>
          <th>ç±»åˆ«</th>
          <th>ä»»åŠ¡</th>
          <th>çŠ¶æ€</th>
          <th>è®¡åˆ’<br>(åˆ†é’Ÿ)</th>
          <th>å®é™…<br>(åˆ†é’Ÿ)</th>
          <th>å®Œæˆç‡</th>
          <th>æ­£ç¡®ç‡</th>
          <th>å¤‡æ³¨</th>
        </tr>
      </thead>
      <tbody>
        {% for task in tasks %}
        <tr>
          <td class="student-name">{{ task.student }}</td>
          <td>{{ task.date }}</td>
          <td class="category-cell">{{ task.category }}</td>
          <td class="detail-cell">{{ task.detail }}</td>
          <td>
            {% if task.status == 'done' %}
            <span class="status-badge status-done">å·²å®Œæˆ</span>
            {% elif task.status == 'progress' %}
            <span class="status-badge status-progress">è¿›è¡Œä¸­</span>
            {% elif task.status == 'pending' %}
            <span class="status-badge status-pending">æœªå¼€å§‹</span>
            {% else %}{{ task.status or 'â€”' }}{% endif %}
          </td>
          <td>{{ task.planned_minutes }}</td>
          <td>{{ '%.1f'|format(task.actual_minutes) }}</td>
          <td>{{ task.completion_rate }}</td>
          <td>{{ task.accuracy }}</td>
          <td class="note-cell">{{ task.note }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="footer-note">
    <div class="footer-icon">â„¹ï¸</div>
    <div>æœ¬æŠ¥å‘Šç”± Sage Path å­¦ä¹ ç®¡ç†ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œä»…ä¾›å†…éƒ¨å‚è€ƒä½¿ç”¨ã€‚</div>
  </div>
</body>

</html>