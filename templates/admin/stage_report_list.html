{% extends "base.html" %}

{% block page_subtitle %}Stage Report{% endblock %}
{% block page_title %}阶段学习报告管理{% endblock %}

{% block content_dashboard %}
<div class="container">
  <div class="header-row">
    <h2>阶段学习报告</h2>
    <a href="{{ url_for('stage_report_create') }}" class="btn btn-primary">+ 新建报告</a>
  </div>

  <div class="card">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>报告标题</th>
          <th>学生</th>
          <th>阶段区间</th>
          <th>创建人</th>
          <th>更新时间</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for report in reports %}
        <tr>
          <td>{{ report.id }}</td>
          <td>{{ report.title or '未命名报告' }}</td>
          <td>{{ report.student.full_name if report.student else '未知' }}</td>
          <td>{{ report.start_date }} 至 {{ report.end_date }}</td>
          <td>{{ report.creator.display_name if report.creator else '系统' }}</td>
          <td>{{ report.updated_at.strftime('%Y-%m-%d %H:%M') }}</td>
          <td class="actions">
            <a class="btn btn-sm btn-outline" href="{{ url_for('stage_report_create', report_id=report.id) }}">查看/编辑</a>
            <a class="btn btn-sm btn-primary" href="{{ url_for('export_stage_report_pdf', report_id=report.id) }}" target="_blank">下载PDF</a>
            <form method="post" action="{{ url_for('delete_stage_report', report_id=report.id) }}" onsubmit="return confirm('确定删除该报告吗？');">
              <button type="submit" class="btn btn-sm btn-danger">删除</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7" class="empty">暂无报告，请点击右上角新建。</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<style>
  .header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }
  .data-table {
    width: 100%;
    border-collapse: collapse;
  }
  .data-table th,
  .data-table td {
    border-bottom: 1px solid #e9eef3;
    padding: 10px;
    text-align: left;
    vertical-align: middle;
  }
  .data-table th {
    color: #6b7280;
    font-weight: 600;
  }
  .actions {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }
  .actions form {
    margin: 0;
  }
  .btn-danger {
    background: #dc2626;
    color: #fff;
    border: none;
  }
  .empty {
    text-align: center;
    color: #8b96a6;
    padding: 20px 0;
  }
</style>
{% endblock %}
