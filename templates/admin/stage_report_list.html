{% extends "base.html" %}

{% block page_subtitle %}Stage Report{% endblock %}
{% block page_title %}é˜¶æ®µå­¦ä¹ æŠ¥å‘Šç®¡ç†{% endblock %}

{% block content_dashboard %}
<div class="container">
  <div class="header-row">
    <div>
      <h2>é˜¶æ®µå­¦ä¹ æŠ¥å‘Š</h2>
      <p class="header-desc">ä¸ºæ¯ä½å­¦ç”Ÿç”Ÿæˆé˜¶æ®µå­¦ä¹ åˆ†æï¼Œæ”¯æŒç¼–è¾‘å’Œ PDF ä¸‹è½½</p>
    </div>
    <a href="{{ url_for('stage_report_create') }}" class="btn btn-primary">+ æ–°å»ºæŠ¥å‘Š</a>
  </div>

  <div class="card" style="border-radius:14px;padding:4px 0;">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>æŠ¥å‘Šæ ‡é¢˜</th>
          <th>å­¦ç”Ÿ</th>
          <th>é˜¶æ®µåŒºé—´</th>
          <th>åˆ›å»ºäºº</th>
          <th>æ›´æ–°æ—¶é—´</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody>
        {% for report in reports %}
        <tr>
          <td class="id-cell">{{ report.id }}</td>
          <td class="title-cell">{{ report.title or 'æœªå‘½åæŠ¥å‘Š' }}</td>
          <td><span class="student-badge">{{ report.student.full_name if report.student else 'æœªçŸ¥' }}</span></td>
          <td class="date-cell">{{ report.start_date }} è‡³ {{ report.end_date }}</td>
          <td>{{ report.creator.display_name if report.creator else 'ç³»ç»Ÿ' }}</td>
          <td class="date-cell">{{ report.updated_at.strftime('%Y-%m-%d %H:%M') }}</td>
          <td class="actions">
            <a class="btn btn-sm btn-outline" href="{{ url_for('stage_report_create', report_id=report.id) }}">ç¼–è¾‘</a>
            <a class="btn btn-sm btn-pdf-sm" href="{{ url_for('export_stage_report_pdf', report_id=report.id) }}" target="_blank">ğŸ“„ PDF</a>
            <form method="post" action="{{ url_for('delete_stage_report', report_id=report.id) }}" onsubmit="return confirm('ç¡®å®šåˆ é™¤è¯¥æŠ¥å‘Šå—ï¼Ÿ');">
              <button type="submit" class="btn btn-sm btn-danger">åˆ é™¤</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7" class="empty">æš‚æ— æŠ¥å‘Šï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’æ–°å»ºã€‚</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<style>
  .header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }
  .header-row h2 {
    margin: 0;
  }
  .header-desc {
    margin: 4px 0 0 0;
    font-size: 13px;
    color: #6b7280;
  }
  .data-table {
    width: 100%;
    border-collapse: collapse;
  }
  .data-table thead th {
    background: #0f766e;
    color: #fff;
    font-weight: 600;
    font-size: 13px;
    padding: 12px 10px;
    border: none;
  }
  .data-table thead th:first-child {
    border-radius: 10px 0 0 0;
  }
  .data-table thead th:last-child {
    border-radius: 0 10px 0 0;
  }
  .data-table td {
    border-bottom: 1px solid #e9eef3;
    padding: 12px 10px;
    text-align: left;
    vertical-align: middle;
    font-size: 14px;
  }
  .data-table tbody tr:hover {
    background: #f0fdfa;
  }
  .data-table tbody tr:nth-child(even) {
    background: #f8fcfb;
  }
  .data-table tbody tr:nth-child(even):hover {
    background: #ecfdf5;
  }
  .id-cell {
    color: #9ca3af;
    font-size: 13px;
  }
  .title-cell {
    font-weight: 600;
    color: #1f2937;
  }
  .date-cell {
    color: #6b7280;
    font-size: 13px;
  }
  .student-badge {
    display: inline-block;
    background: #f0fdfa;
    color: #0f766e;
    font-weight: 600;
    font-size: 13px;
    padding: 3px 10px;
    border-radius: 6px;
    border: 1px solid #99d8cf;
  }
  .actions {
    display: flex;
    gap: 6px;
    align-items: center;
    flex-wrap: wrap;
  }
  .actions form {
    margin: 0;
  }
  .btn-pdf-sm {
    border: 1px solid #0f766e;
    background: #f0fdfa;
    color: #0f766e !important;
    font-weight: 600;
  }
  .btn-pdf-sm:hover {
    background: #ccfbf1;
  }
  .btn-danger {
    background: #dc2626;
    color: #fff;
    border: none;
  }
  .btn-danger:hover {
    background: #b91c1c;
  }
  .empty {
    text-align: center;
    color: #8b96a6;
    padding: 40px 0;
    font-size: 14px;
  }
</style>
{% endblock %}
